#!/bin/sh

echo 'üöÄ Formatting, testing and building your project before committing'

# ‚ú® Colors for better output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ‚ú® Function to run command with engine bypass
run_with_bypass() {
    local command="$1"
    local error_message="$2"
    
    echo "Running: $command"
    
    # ‚ú® --ignore-engines flag'i yarn run'dan sonra gelir, script'ten √∂nce
    if ! yarn --ignore-engines run $command; then
        echo "${RED}$error_message${NC}"
        exit 1
    fi
}

# ‚ú® Prettier check
run_with_bypass "format:check" "Prettier Check Failed. Run 'yarn format:write', add changes and try commit again. ‚ùå"

# ‚ú® ESLint check  
run_with_bypass "lint" "ESLint Check Failed. Make the required changes listed above, add changes and try to commit again. ‚ùå"

# ‚ú® TypeScript check
run_with_bypass "tsc" "TypeScript Check Failed. Make the changes required above. ‚ùå"

echo "${YELLOW}Code looks good... Trying to build now.${NC}"

# # ‚ú® Build check
# run_with_bypass "build" "Next build failed: View the errors above to see why. ‚ùå"

echo "${GREEN}‚úÖ All checks passed! Committing now.${NC}"